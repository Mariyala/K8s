Deployments

kubectl get deployments

kubectl create deployment ws-deploy --image vitovts/k8sphp:latest --port=80

kubectl get deploy
kubectl describe deploy

kubectl scale deployment ws-deploy --replicas 4
kubectl get deploy
kubectl get rs
kubectl delete pods xxx
kubectl get pods

kubectl autoscale deployment ws-deploy --min=4 --max=6 --cpu-percent=80
kubectl get hpa

#
kubectl rollout history deployment/ws-deploy
kubectl rollout status deployment/ws-deploy


# преход на новую версию
kubectl describe deployment ws-deploy
>>> Containers:
    k8sphp:
 ...
kubectl set image deployment/ws-deploy k8sphp=nginx:latest
kubectl set image deployment/ws-deploy k8sphp=vitovts/k8sphp:version1 --record
kubectl rollout history deployment/ws-deploy
kubectl set image deployment/ws-deploy k8sphp=vitovts/k8sphp:version2 --record


kubectl set image deployment/ws-deploy nginx=nginx --record
kubectl set image deployment/ws-deploy nginx=nginx --to-revision=4
kubectl set image deployment/ws-deploy nginx=nginx:latest --record

# возврат на пред идущую версию
kubectl rollout undo deployment/ws-deploy

#
kubectl describe deployment/ws-deployment
# restart
kubectl rollout restart deployment/ws-deploy
# delete all deployment
kubectl delete deployment --all


kubectl port-forward my-web-deploy-r3-b699d9b74-dnsgq 5555:80


